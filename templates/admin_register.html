<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Register - Query Portal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- HEADER -->
    <header class="site-header">
        <div class="header-container" style="justify-content: center;">
            <img src="{{ url_for('static', filename='images/cmp_header.jpg') }}"
                 alt="CMP Degree College Header Image"
                 style="width: 100%; max-width: 826px; height: auto; display: block; margin: 0 auto;">
        </div>
    </header>

    <!-- FORM -->
    <main class="login-main">
        <section class="login-section">
            <div class="login-container">
                <h2>Create Admin Account</h2>
                
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <p style="color: red;">{{ message }}</p>
                    {% endfor %}
                {% endif %}
                {% endwith %}
                
                <form method="POST" action="{{ url_for('admin_register') }}" id="adminSignupForm">
                    <!-- ðŸ†• FIXED: name="name" instead of name="full_name" -->
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Create Password</label>
                        <input type="password" class="form-control" id="password" name="password" minlength="8" required>
                        <button type="button" class="btn btn-secondary btn-sm mt-1" onclick="generateStrongPassword()">Generate Strong Password</button>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm_password">Confirm Password</label>
                        <input type="password" class="form-control" id="confirm_password" name="confirm_password" minlength="8" required>
                    </div>
                    
                    <button type="submit" class="btn-main" id="submitBtn">Create Account</button>
                </form>
                
                <div class="login-links">
                    <a href="{{ url_for('admin_login') }}">Back to Login</a>
                    <a href="/">Back to Home</a>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="copyright">Copyright Â© 2025. All rights reserved.</div>
        </div>
    </footer>

<script>
function generateStrongPassword() {
    const lowers = 'abcdefghijklmnopqrstuvwxyz';
    const uppers = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const nums = '0123456789';
    const specials = '!@#$%^&*()-_=+[]{};:,.<>?/';
    let pw = '';
    pw += lowers[Math.floor(Math.random() * lowers.length)];
    pw += uppers[Math.floor(Math.random() * uppers.length)];
    pw += nums[Math.floor(Math.random() * nums.length)];
    pw += specials[Math.floor(Math.random() * specials.length)];
    const all = lowers + uppers + nums + specials;
    for (let i = 0; i < 8; i++) {
        pw += all[Math.floor(Math.random() * all.length)];
    }
    pw = pw.split('').sort(() => 0.5 - Math.random()).join('');
    const passwordField = document.getElementById('password');
    passwordField.value = pw.slice(0, 12);
    passwordField.dispatchEvent(new Event('input', { bubbles: true }));
    document.getElementById('confirm_password').focus();
}

// Real-time password confirmation validation
document.addEventListener('DOMContentLoaded', function() {
    const confirmPasswordField = document.getElementById('confirm_password');
    const passwordField = document.getElementById('password');
    const submitBtn = document.getElementById('submitBtn');
    
    function validatePasswordMatch() {
        const password = passwordField.value;
        const confirmPassword = confirmPasswordField.value;
        
        if (confirmPassword && password !== confirmPassword) {
            confirmPasswordField.style.borderColor = '#dc3545';
            submitBtn.disabled = true;
            submitBtn.textContent = 'Passwords do not match';
            submitBtn.style.backgroundColor = '#6c757d';
        } else if (password && confirmPassword) {
            confirmPasswordField.style.borderColor = '#28a745';
            submitBtn.disabled = false;
            submitBtn.textContent = 'Create Account';
            submitBtn.style.backgroundColor = '';
        }
    }
    
    passwordField.addEventListener('input', validatePasswordMatch);
    confirmPasswordField.addEventListener('input', validatePasswordMatch);
});

// Form submission validation
document.getElementById('adminSignupForm').addEventListener('submit', function(e) {
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    
    if (password !== confirmPassword) {
        e.preventDefault();
        alert('Passwords do not match! Please try again.');
        document.getElementById('confirm_password').focus();
        return false;
    }
    
    if (password.length < 8) {
        e.preventDefault();
        alert('Password must be at least 8 characters long!');
        document.getElementById('password').focus();
        return false;
    }
});
</script>
</body>
</html>
